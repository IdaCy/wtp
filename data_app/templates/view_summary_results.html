{% extends 'base.html' %} {# !! comment like this #}

{% block content %}
    <h1>Summary of Records</h1>

    <!-- Habitat selection form -->
    <form id="habitat_form" method="GET">
        <label for="habitat">Select Habitat:</label>
        <select id="habitat" name="habitat">
            <option value="">Please select</option>
            {% for habitat_name in habitats %}
                <option value="{{ habitat_name }}" {% if request.GET.habitat == habitat_name %}selected{% endif %}>
                    {{ habitat_name }}
                </option>
            {% endfor %}
        </select>

        <br>

        <!-- radio buttons -->
        <input type="radio" id="wildlife" name="selection_type" value="wildlife"
               {% if selection_type == "wildlife" %}checked{% endif %}>
        <label for="wildlife">Wildlife Group</label>

        <input type="radio" id="rap" name="selection_type" value="rap"
               {% if selection_type == "rap" %}checked{% endif %}>
        <label for="rap">ICRP RAP</label>

        <!-- second dropdown -->
        <select id="wildlife_group" name="selection_id"
                style="{% if selection_type != 'wildlife' %}display:none;{% endif %}">
            {% for group in wildlife_groups %}
                <option value="{{ group.id }}" {% if selection_id == group.id and selection_type == 'wildlife' %}
                        selected {% endif %}>
                    {{ group.wildlife_group_name }}
                </option>
            {% endfor %}
        </select>
        <select id="rap_group" name="selection_id" style="{% if selection_type != 'rap' %}display:none;{% endif %}">
            {% for group in raps %}
                <option value="{{ group.id }}" {% if selection_id == group.id and selection_type == 'rap' %}
                        selected {% endif %}>
                    {{ group.rap_name }}
                </option>
            {% endfor %}
        </select>

    </form>

    <!-- Data table -->
    <table>
        <thead>
        <tr>
            <th>Element</th>
            <th>Arithmetic Mean CR</th>
            <th>Arith Standard Deviation</th>
            <th>Geometric Mean CR</th>
            <th>Geo Standard Deviation</th>
            <th>Min</th>
            <th>Max</th>
            <th>N</th>
            <th>Reference ID</th>
        </tr>
        </thead>
        <tbody>
        {% for item in datacr_list %}
            <tr>
                <td>{{ item.radionuclide__element__element_symbol }}</td>
                <td>{{ item.arith_mean_cr }}</td>
                <td>{{ item.arith_std_dev }}</td>
                <td>{{ item.geo_mean_cr }}</td>
                <td>{{ item.geo_std_dev }}</td>
                <td>{{ item.min_cr }}</td>
                <td>{{ item.max_cr }}</td>
                <td>{{ item.sum_crn }}</td>
                <td>{{ item.reference_ids }}</td>
            </tr>
        {% empty %}
            <tr>
                <td colspan="3">No data found.</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <script>
        document.addEventListener("DOMContentLoaded", function () {

            function submitForm() {
                var selectionType = document.querySelector('input[name="selection_type"]:checked').value;
                // Dynamically set the name attribute based on the selected type
                if (selectionType === 'wildlife') {
                    document.getElementById('wildlife_group').setAttribute('name', 'selection_id');
                    document.getElementById('rap_group').removeAttribute('name');
                } else if (selectionType === 'rap') {
                    document.getElementById('rap_group').setAttribute('name', 'selection_id');
                    document.getElementById('wildlife_group').removeAttribute('name');
                }
                document.getElementById('habitat_form').submit();
            }

            // Attach the submitForm function to all relevant form controls
            document.getElementById('habitat').addEventListener('change', submitForm);
            document.querySelectorAll('input[name="selection_type"]').forEach(input => {
                input.addEventListener('change', submitForm);
            });
            document.getElementById('wildlife_group').addEventListener('change', submitForm);
            document.getElementById('rap_group').addEventListener('change', submitForm);
        });
    </script>
    <link rel="stylesheet" href="/static/css/view_summary_results.css">
{% endblock %}
