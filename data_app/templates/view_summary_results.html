{% extends 'base.html' %} {# !! comment like this #}

{% block content %}
    <h1>Summary of Records</h1>

    <!-- Habitat selection form -->
    <form id="habitat_form">
        <label for="habitat">Select Habitat:</label>
        <select id="habitat" name="habitat" onchange="submitForm()">
            <option value="">Please select</option>
            <option value="Estuarine (water)" {% if request.GET.habitat == "Estuarine (water)" %}selected{% endif %}>Estuarine (water)
            <option value="Freshwater" {% if request.GET.habitat == "Freshwater" %}selected{% endif %}>Freshwater
            </option>
            <option value="Marine" {% if request.GET.habitat == "Marine" %}selected{% endif %}>Marine</option>
            <option value="Terrestrial" {% if request.GET.habitat == "Terrestrial" %}selected{% endif %}>Terrestrial
            </option>
        </select>

        <br>

        <input type="radio" id="wildlife" name="selection_type" value="wildlife"
               {% if selection_type == "wildlife" %}checked{% endif %}>
        <label for="wildlife">Wildlife Group</label>
        <select id="wildlife_group" name="selection_id"
                style="{% if selection_type != 'wildlife' %}display:none;{% endif %}">
            {% for group in wildlife_groups %}
                <option value="{{ group.id }}"
                        {% if selection_id == group.id %}selected{% endif %}>{{ group.wildlife_group_name }}</option>
            {% endfor %}
        </select>

        <input type="radio" id="rap" name="selection_type" value="rap"
               {% if selection_type == "rap" %}checked{% endif %}>
        <label for="rap">ICRP RAP</label>
        <select id="rap_group" name="selection_id" style="{% if selection_type != 'rap' %}display:none;{% endif %}">
            {% for rap in raps %}
                <option value="{{ rap.id }}"
                        {% if selection_id == rap.id %}selected{% endif %}>{{ rap.rap_name }}</option>
            {% endfor %}
        </select>

        <button type="submit">Filter</button>
    </form>

    <!-- Data table -->
    <table>
        <thead>
        <tr>
            <th>Element</th>
            <th>Arithmetic Mean CR</th>
            <th>Arith Standard Deviation</th>
            <th>Geometric Mean CR</th>
            <th>Geo Standard Deviation</th>
            <th>Min</th>
            <th>Max</th>
            <th>N</th>
            <th>Reference ID</th>
        </tr>
        </thead>
        <tbody>
        {% for item in datacr_list %}
            <tr>
                <td>{{ item.radionuclide__element__element_symbol }}</td>
                <td>{{ item.arith_mean_cr }}</td>
                <td>{{ item.arith_std_dev }}</td>
                <td>{{ item.geo_mean_cr }}</td>
                <td>{{ item.geo_std_dev }}</td>
                <td>{{ item.min_cr }}</td>
                <td>{{ item.max_cr }}</td>
                <td>{{ item.sum_crn }}</td>
                <td>{{ item.reference_ids }}</td>
            </tr>
        {% empty %}
            <tr>
                <td colspan="3">No data found.</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <script>
        function submitForm() {
            var habitat = document.getElementById('habitat').value;
            var form = document.getElementById('habitat_form');
            form.action = '/view_summary_results/?habitat=' + habitat;
            form.submit();
        }

        document.getElementById('wildlife').onchange = function () {
            document.getElementById('wildlife_group').style.display = 'block';
            document.getElementById('rap_group').style.display = 'none';
        };
        document.getElementById('rap').onchange = function () {
            document.getElementById('wildlife_group').style.display = 'none';
            document.getElementById('rap_group').style.display = 'block';
        };
    </script>
    <link rel="stylesheet" href="/static/css/view_summary_results.css">
{% endblock %}
